##################
#This file imputes missing values of continuous data using Predictive Mean Matching (PMM) imputation
#This example uses an anthropological dataset that has 5% missing data
#Examines the success of PMM imputation of these data against the complete dataset
#################

#This approach uses the R package 'mice'
#The R package 'irr' is used for Cohen's kappa
#continuousdata.csv = the full dataset (used only for evaluating level of success)
#one.csv = the csv file that has 5% missing values

**Variable Names**
#FL_L - femur length left
#FL_R - femur length right
#T1.AP - T1 antero-posterior length
#T1.TR - T1 transverse length
#L1.AP - L1 antero-posterior length
#L1.TR - L1 transverse length

###################################
Set up workspace and load libraries
###################################

rm(list=ls())

library(mice)
library(irr)

setwd("C:/Users/Amanda Wissler/Documents/Spring/imputation")
dat<-read.csv("continuousdata.csv", header=T)

#Load the datasets that have 5% missing data. In this case I have 5 different datasets. 
cont.five.1<-read.csv("cont.five.1.csv", header=T)
cont.five.2<-read.csv("cont.five.2.csv", header=T)
cont.five.3<-read.csv("cont.five.3.csv", header=T)
cont.five.4<-read.csv("cont.five.4.csv", header=T)
cont.five.5<-read.csv("cont.five.5.csv", header=T)

#Establish the mean and variance for the complete dataset so you can evaluate imputed values
FL.Ldatmean<-mean(dat$FL_Left)
FL.Rdatmean<-mean(dat$FL_Right)
T1.APdatmean<-mean(dat$T1.AP)
T1.TRdatmean<-mean(dat$T1.TR)
T5.APdatmean<-mean(dat$T5.AP)
T5.TRdatmean<-mean(dat$T5.TR)
T10.APdatmean<-mean(dat$T10.AP)
T10.TRdatmean<-mean(dat$T10.TR)
L1.APdatmean<-mean(dat$L1.AP)
L1.TRdatmean<-mean(dat$L1.TR)
L3.APdatmean<-mean(dat$L3.AP)
L3.TRdatmean<-mean(dat$L3.TR)

FL.Ldatvar<-var(dat$FL_Left)
FL.Rdatvar<-var(dat$FL_Right)
T1.APdatvar<-var(dat$T1.AP)
T1.TRdatvar<-var(dat$T1.TR)
T5.APdatvar<-var(dat$T5.AP)
T5.TRdatvar<-var(dat$T5.TR)
T10.APdatvar<-var(dat$T10.AP)
T10.TRdatvar<-var(dat$T10.TR)
L1.APdatvar<-var(dat$L1.AP)
L1.TRdatvar<-var(dat$L1.TR)
L3.APdatvar<-var(dat$L3.AP)
L3.TRdatvar<-var(dat$L3.TR)

################
Impute the data
###############

#Using the 'mice' package
#m = number of imputations
#maxit = the number of iterations
#method = sets the method. In this case we want PMM imputation
#seed = set the seed so that you get the same numbers imputed each time you run the code
tempdata.five.1<-mice(cont.five.1, m=10, maxit=50, method="pmm", seed=1)
tempdata.five.2<-mice(cont.five.2, m=10, maxit=50, method="pmm", seed=1)
tempdata.five.3<-mice(cont.five.3, m=10, maxit=50, method="pmm", seed=1)
tempdata.five.4<-mice(cont.five.4, m=10, maxit=50, method="pmm", seed=1)
tempdata.five.5<-mice(cont.five.5, m=10, maxit=50, method="pmm", seed=1)

#################
Complete and Pool
#################

#Each of the m=10 imputations must be added into the dataset and then all 10 versions pooled into a single dataset
#NOTE that pooling the imputed values at this point prior to running statistical analysis violates Rubin's Rules.
#In this case, since we are only interested in the success of the imputation it is okay to pool now

#ONE
one1<-complete(tempdata.five.1,1)
two1<-complete(tempdata.five.1,2)
three1<-complete(tempdata.five.1,3)
four1<-complete(tempdata.five.1,4)
five1<-complete(tempdata.five.1,5)  
six1<-complete(tempdata.five.1,6) 
seven1<-complete(tempdata.five.1,7) 
eight1<-complete(tempdata.five.1,8) 
nine1<-complete(tempdata.five.1,9) 
ten1<-complete(tempdata.five.1,10)

five_one_imp<-(one1 + two1 + three1 + four1 + five1 + six1 + seven1 + eight1 + nine1 + ten1)/10

#TWO
one2<-complete(tempdata.five.2,1)
two2<-complete(tempdata.five.2,2)
three2<-complete(tempdata.five.2,3)
four2<-complete(tempdata.five.2,4)
five2<-complete(tempdata.five.2,5)
six2<-complete(tempdata.five.2,6) 
seven2<-complete(tempdata.five.2,7) 
eight2<-complete(tempdata.five.2,8) 
nine2<-complete(tempdata.five.2,9) 
ten2<-complete(tempdata.five.2,10)

five_two_imp<-(one2 + two2 + three2 + four2 + five2 + six2 + seven2 + eight2 + nine2 + ten2)/10

#THREE
one3<-complete(tempdata.five.3,1)
two3<-complete(tempdata.five.3,2)
three3<-complete(tempdata.five.3,3)
four3<-complete(tempdata.five.3,4)
five3<-complete(tempdata.five.3,5)  
six3<-complete(tempdata.five.3,6) 
seven3<-complete(tempdata.five.3,7) 
eight3<-complete(tempdata.five.3,8) 
nine3<-complete(tempdata.five.3,9) 
ten3<-complete(tempdata.five.3,10)

five_three_imp<-(one3 + two3 + three3 + four3 + five3 + six3 + seven3 + eight3 + nine3 + ten3)/10

#FOUR
one4<-complete(tempdata.five.4,1)
two4<-complete(tempdata.five.4,2)
three4<-complete(tempdata.five.4,3)
four4<-complete(tempdata.five.4,4)
five4<-complete(tempdata.five.4,5)  
six4<-complete(tempdata.five.4,6) 
seven4<-complete(tempdata.five.4,7) 
eight4<-complete(tempdata.five.4,8) 
nine4<-complete(tempdata.five.4,9) 
ten4<-complete(tempdata.five.4,10)

five_four_imp<-(one4 + two4 + three4 + four4 + five4 + six4 + seven4 + eight4 + nine4 + ten4)/10

#FIVE
one5<-complete(tempdata.five.5,1)
two5<-complete(tempdata.five.5,2)
three5<-complete(tempdata.five.5,3)
four5<-complete(tempdata.five.5,4)
five5<-complete(tempdata.five.5,5) 
six5<-complete(tempdata.five.5,6) 
seven5<-complete(tempdata.five.5,7) 
eight5<-complete(tempdata.five.5,8) 
nine5<-complete(tempdata.five.5,9) 
ten5<-complete(tempdata.five.5,10)

five_five_imp<-(one5 + two5 + three5 + four5 + five5 + six5 + seven5 + eight5 + nine5 + ten5)/10

#################################
#Assess Success of Imputed Values
#################################

#By success, we mean how close the imputed datasets are to the original dataset
#Below, we separate each variable to assess

#ONE
FL.Lmean.PMM.1<-mean(five_one_imp$FL_L, na.rm=TRUE)
FL.Rmean.PMM.1<-mean(five_one_imp$FL_R, na.rm=TRUE)
T1.APmean.PMM.1<-mean(five_one_imp$T1.AP, na.rm=TRUE)
T1.TRmean.PMM.1<-mean(five_one_imp$T1.TR, na.rm=TRUE)
T5.APmean.PMM.1<-mean(five_one_imp$T5.AP, na.rm=TRUE)
T5.TRmean.PMM.1<-mean(five_one_imp$T5.TR, na.rm=TRUE)
T10.APmean.PMM.1<-mean(five_one_imp$T10.AP, na.rm=TRUE)
T10.TRmean.PMM.1<-mean(five_one_imp$T10.TR, na.rm=TRUE)
L1.APmean.PMM.1<-mean(five_one_imp$L1.AP, na.rm=TRUE)
L1.TRmean.PMM.1<-mean(five_one_imp$L1.TR, na.rm=TRUE)
L3.APmean.PMM.1<-mean(five_one_imp$L3.AP, na.rm=TRUE)
L3.TRmean.PMM.1<-mean(five_one_imp$L3.TR, na.rm=TRUE)

FL.Lvar.PMM.1<-var(five_one_imp$FL_L, na.rm=TRUE)
FL.Rvar.PMM.1<-var(five_one_imp$FL_R, na.rm=TRUE)
T1.APvar.PMM.1<-var(five_one_imp$T1.AP, na.rm=TRUE)
T1.TRvar.PMM.1<-var(five_one_imp$T1.TR, na.rm=TRUE)
T5.APvar.PMM.1<-var(five_one_imp$T5.AP, na.rm=TRUE)
T5.TRvar.PMM.1<-var(five_one_imp$T5.TR, na.rm=TRUE)
T10.APvar.PMM.1<-var(five_one_imp$T10.AP, na.rm=TRUE)
T10.TRvar.PMM.1<-var(five_one_imp$T10.TR, na.rm=TRUE)
L1.APvar.PMM.1<-var(five_one_imp$L1.AP, na.rm=TRUE)
L1.TRvar.PMM.1<-var(five_one_imp$L1.TR, na.rm=TRUE)
L3.APvar.PMM.1<-var(five_one_imp$L3.AP, na.rm=TRUE)
L3.TRvar.PMM.1<-var(five_one_imp$L3.TR, na.rm=TRUE)

#TWO
FL.Lmean.PMM.2<-mean(five_two_imp$FL_L, na.rm=TRUE)
FL.Rmean.PMM.2<-mean(five_two_imp$FL_R, na.rm=TRUE)
T1.APmean.PMM.2<-mean(five_two_imp$T1.AP, na.rm=TRUE)
T1.TRmean.PMM.2<-mean(five_two_imp$T1.TR, na.rm=TRUE)
T5.APmean.PMM.2<-mean(five_two_imp$T5.AP, na.rm=TRUE)
T5.TRmean.PMM.2<-mean(five_two_imp$T5.TR, na.rm=TRUE)
T10.APmean.PMM.2<-mean(five_two_imp$T10.AP, na.rm=TRUE)
T10.TRmean.PMM.2<-mean(five_two_imp$T10.TR, na.rm=TRUE)
L1.APmean.PMM.2<-mean(five_two_imp$L1.AP, na.rm=TRUE)
L1.TRmean.PMM.2<-mean(five_two_imp$L1.TR, na.rm=TRUE)
L3.APmean.PMM.2<-mean(five_two_imp$L3.AP, na.rm=TRUE)
L3.TRmean.PMM.2<-mean(five_two_imp$L3.TR, na.rm=TRUE)

FL.Lvar.PMM.2<-var(five_two_imp$FL_L, na.rm=TRUE)
FL.Rvar.PMM.2<-var(five_two_imp$FL_R, na.rm=TRUE)
T1.APvar.PMM.2<-var(five_two_imp$T1.AP, na.rm=TRUE)
T1.TRvar.PMM.2<-var(five_two_imp$T1.TR, na.rm=TRUE)
T5.APvar.PMM.2<-var(five_two_imp$T5.AP, na.rm=TRUE)
T5.TRvar.PMM.2<-var(five_two_imp$T5.TR, na.rm=TRUE)
T10.APvar.PMM.2<-var(five_two_imp$T10.AP, na.rm=TRUE)
T10.TRvar.PMM.2<-var(five_two_imp$T10.TR, na.rm=TRUE)
L1.APvar.PMM.2<-var(five_two_imp$L1.AP, na.rm=TRUE)
L1.TRvar.PMM.2<-var(five_two_imp$L1.TR, na.rm=TRUE)
L3.APvar.PMM.2<-var(five_two_imp$L3.AP, na.rm=TRUE)
L3.TRvar.PMM.2<-var(five_two_imp$L3.TR, na.rm=TRUE)

#THREE
FL.Lmean.PMM.3<-mean(five_three_imp$FL_L, na.rm=TRUE)
FL.Rmean.PMM.3<-mean(five_three_imp$FL_R, na.rm=TRUE)
T1.APmean.PMM.3<-mean(five_three_imp$T1.AP, na.rm=TRUE)
T1.TRmean.PMM.3<-mean(five_three_imp$T1.TR, na.rm=TRUE)
T5.APmean.PMM.3<-mean(five_three_imp$T5.AP, na.rm=TRUE)
T5.TRmean.PMM.3<-mean(five_three_imp$T5.TR, na.rm=TRUE)
T10.APmean.PMM.3<-mean(five_three_imp$T10.AP, na.rm=TRUE)
T10.TRmean.PMM.3<-mean(five_three_imp$T10.TR, na.rm=TRUE)
L1.APmean.PMM.3<-mean(five_three_imp$L1.AP, na.rm=TRUE)
L1.TRmean.PMM.3<-mean(five_three_imp$L1.TR, na.rm=TRUE)
L3.APmean.PMM.3<-mean(five_three_imp$L3.AP, na.rm=TRUE)
L3.TRmean.PMM.3<-mean(five_three_imp$L3.TR, na.rm=TRUE)

FL.Lvar.PMM.3<-var(five_three_imp$FL_L, na.rm=TRUE)
FL.Rvar.PMM.3<-var(five_three_imp$FL_R, na.rm=TRUE)
T1.APvar.PMM.3<-var(five_three_imp$T1.AP, na.rm=TRUE)
T1.TRvar.PMM.3<-var(five_three_imp$T1.TR, na.rm=TRUE)
T5.APvar.PMM.3<-var(five_three_imp$T5.AP, na.rm=TRUE)
T5.TRvar.PMM.3<-var(five_three_imp$T5.TR, na.rm=TRUE)
T10.APvar.PMM.3<-var(five_three_imp$T10.AP, na.rm=TRUE)
T10.TRvar.PMM.3<-var(five_three_imp$T10.TR, na.rm=TRUE)
L1.APvar.PMM.3<-var(five_three_imp$L1.AP, na.rm=TRUE)
L1.TRvar.PMM.3<-var(five_three_imp$L1.TR, na.rm=TRUE)
L3.APvar.PMM.3<-var(five_three_imp$L3.AP, na.rm=TRUE)
L3.TRvar.PMM.3<-var(five_three_imp$L3.TR, na.rm=TRUE)

#FOUR
FL.Lmean.PMM.4<-mean(five_four_imp$FL_L, na.rm=TRUE)
FL.Rmean.PMM.4<-mean(five_four_imp$FL_R, na.rm=TRUE)
T1.APmean.PMM.4<-mean(five_four_imp$T1.AP, na.rm=TRUE)
T1.TRmean.PMM.4<-mean(five_four_imp$T1.TR, na.rm=TRUE)
T5.APmean.PMM.4<-mean(five_four_imp$T5.AP, na.rm=TRUE)
T5.TRmean.PMM.4<-mean(five_four_imp$T5.TR, na.rm=TRUE)
T10.APmean.PMM.4<-mean(five_four_imp$T10.AP, na.rm=TRUE)
T10.TRmean.PMM.4<-mean(five_four_imp$T10.TR, na.rm=TRUE)
L1.APmean.PMM.4<-mean(five_four_imp$L1.AP, na.rm=TRUE)
L1.TRmean.PMM.4<-mean(five_four_imp$L1.TR, na.rm=TRUE)
L3.APmean.PMM.4<-mean(five_four_imp$L3.AP, na.rm=TRUE)
L3.TRmean.PMM.4<-mean(five_four_imp$L3.TR, na.rm=TRUE)

FL.Lvar.PMM.4<-var(five_four_imp$FL_L, na.rm=TRUE)
FL.Rvar.PMM.4<-var(five_four_imp$FL_R, na.rm=TRUE)
T1.APvar.PMM.4<-var(five_four_imp$T1.AP, na.rm=TRUE)
T1.TRvar.PMM.4<-var(five_four_imp$T1.TR, na.rm=TRUE)
T5.APvar.PMM.4<-var(five_four_imp$T5.AP, na.rm=TRUE)
T5.TRvar.PMM.4<-var(five_four_imp$T5.TR, na.rm=TRUE)
T10.APvar.PMM.4<-var(five_four_imp$T10.AP, na.rm=TRUE)
T10.TRvar.PMM.4<-var(five_four_imp$T10.TR, na.rm=TRUE)
L1.APvar.PMM.4<-var(five_four_imp$L1.AP, na.rm=TRUE)
L1.TRvar.PMM.4<-var(five_four_imp$L1.TR, na.rm=TRUE)
L3.APvar.PMM.4<-var(five_four_imp$L3.AP, na.rm=TRUE)
L3.TRvar.PMM.4<-var(five_four_imp$L3.TR, na.rm=TRUE)

#FIVE
FL.Lmean.PMM.5<-mean(five_five_imp$FL_L, na.rm=TRUE)
FL.Rmean.PMM.5<-mean(five_five_imp$FL_R, na.rm=TRUE)
T1.APmean.PMM.5<-mean(five_five_imp$T1.AP, na.rm=TRUE)
T1.TRmean.PMM.5<-mean(five_five_imp$T1.TR, na.rm=TRUE)
T5.APmean.PMM.5<-mean(five_five_imp$T5.AP, na.rm=TRUE)
T5.TRmean.PMM.5<-mean(five_five_imp$T5.TR, na.rm=TRUE)
T10.APmean.PMM.5<-mean(five_five_imp$T10.AP, na.rm=TRUE)
T10.TRmean.PMM.5<-mean(five_five_imp$T10.TR, na.rm=TRUE)
L1.APmean.PMM.5<-mean(five_five_imp$L1.AP, na.rm=TRUE)
L1.TRmean.PMM.5<-mean(five_five_imp$L1.TR, na.rm=TRUE)
L3.APmean.PMM.5<-mean(five_five_imp$L3.AP, na.rm=TRUE)
L3.TRmean.PMM.5<-mean(five_five_imp$L3.TR, na.rm=TRUE)

FL.Lvar.PMM.5<-var(five_five_imp$FL_L, na.rm=TRUE)
FL.Rvar.PMM.5<-var(five_five_imp$FL_R, na.rm=TRUE)
T1.APvar.PMM.5<-var(five_five_imp$T1.AP, na.rm=TRUE)
T1.TRvar.PMM.5<-var(five_five_imp$T1.TR, na.rm=TRUE)
T5.APvar.PMM.5<-var(five_five_imp$T5.AP, na.rm=TRUE)
T5.TRvar.PMM.5<-var(five_five_imp$T5.TR, na.rm=TRUE)
T10.APvar.PMM.5<-var(five_five_imp$T10.AP, na.rm=TRUE)
T10.TRvar.PMM.5<-var(five_five_imp$T10.TR, na.rm=TRUE)
L1.APvar.PMM.5<-var(five_five_imp$L1.AP, na.rm=TRUE)
L1.TRvar.PMM.5<-var(five_five_imp$L1.TR, na.rm=TRUE)
L3.APvar.PMM.5<-var(five_five_imp$L3.AP, na.rm=TRUE)
L3.TRvar.PMM.5<-var(five_five_imp$L3.TR, na.rm=TRUE)

#Assess Cohen's Kappa and Kendall's Tau 
#Construct a dataframe that puts the actual data values from the real dataset next to each imputed value 
#kappa2 = Cohen's Kappa
#cor.test is the Kendall's tau
#Do for each version of the data. Here it is 5 times

#ONE
FL.L<-cbind(dat$FL_L, five_one_imp$FL_L)
FL.R<-cbind(dat$FL_R, five_one_imp$FL_R)
T1.AP<-cbind(dat$T1.AP, five_one_imp$T1.AP)
T1.TR<-cbind(dat$T1.TR, five_one_imp$T1.TR)
T5.AP<-cbind(dat$T5.AP, five_one_imp$T5.AP)
T5.TR<-cbind(dat$T5.TR, five_one_imp$T5.TR)
T10.AP<-cbind(dat$T10.AP, five_one_imp$T10.AP)
T10.TR<-cbind(dat$T10.TR, five_one_imp$T10.TR)
L1.AP<-cbind(dat$L1.AP, five_one_imp$L1.AP)
L1.TR<-cbind(dat$L1.TR, five_one_imp$L1.TR)
L3.AP<-cbind(dat$L3.AP, five_one_imp$L3.AP)
L3.TR<-cbind(dat$L3.TR, five_one_imp$L3.TR)

FL.LkPMMone<-kappa2(FL.L)
FL.RkPMMone<-kappa2(FL.R)
T1.APkPMMone<-kappa2(T1.AP)
T1.TRkPMMone<-kappa2(T1.TR)
T5.APkPMMone<-kappa2(T5.AP)
T5.TRkPMMone<-kappa2(T5.TR)
T10.APkPMMone<-kappa2(T10.AP)
T10.TRkPMMone<-kappa2(T10.TR)
L1.APkPMMone<-kappa2(L1.AP)
L1.TRkPMMone<-kappa2(L1.TR)
L3.APkPMMone<-kappa2(L3.AP)
L3.TRkPMMone<-kappa2(L3.TR)

FL.LtauPMMone<-cor.test(dat$FL_L, five_one_imp$FL_L, method="kendall")
FL.RtauPMMone<-cor.test(dat$FL_R, five_one_imp$FL_R, method="kendall")
T1.APtauPMMone<-cor.test(dat$T1.AP, five_one_imp$T1.AP, method="kendall")
T1.TRtauPMMone<-cor.test(dat$T1.TR, five_one_imp$T1.TR, method="kendall")
T5.APtauPMMone<-cor.test(dat$T5.AP, five_one_imp$T5.AP, method="kendall")
T5.TRtauPMMone<-cor.test(dat$T5.TR, five_one_imp$T5.TR, method="kendall")
T10.APtauPMMone<-cor.test(dat$T10.AP, five_one_imp$T10.AP, method="kendall")
T10.TRtauPMMone<-cor.test(dat$T10.TR, five_one_imp$T10.TR, method="kendall")
L1.APtauPMMone<-cor.test(dat$L1.AP, five_one_imp$L1.AP, method="kendall")
L1.TRtauPMMone<-cor.test(dat$L1.TR, five_one_imp$L1.TR, method="kendall")
L3.APtauPMMone<-cor.test(dat$L3.AP, five_one_imp$L3.AP, method="kendall")
L3.TRtauPMMone<-cor.test(dat$L3.TR, five_one_imp$L3.TR, method="kendall")

#TWO
FL.L<-cbind(dat$FL_L, five_two_imp$FL_L)
FL.R<-cbind(dat$FL_R, five_two_imp$FL_R)
T1.AP<-cbind(dat$T1.AP, five_two_imp$T1.AP)
T1.TR<-cbind(dat$T1.TR, five_two_imp$T1.TR)
T5.AP<-cbind(dat$T5.AP, five_two_imp$T5.AP)
T5.TR<-cbind(dat$T5.TR, five_two_imp$T5.TR)
T10.AP<-cbind(dat$T10.AP, five_two_imp$T10.AP)
T10.TR<-cbind(dat$T10.TR, five_two_imp$T10.TR)
L1.AP<-cbind(dat$L1.AP, five_two_imp$L1.AP)
L1.TR<-cbind(dat$L1.TR, five_two_imp$L1.TR)
L3.AP<-cbind(dat$L3.AP, five_two_imp$L3.AP)
L3.TR<-cbind(dat$L3.TR, five_two_imp$L3.TR)

FL.LkPMMtwo<-kappa2(FL.L)
FL.RkPMMtwo<-kappa2(FL.R)
T1.APkPMMtwo<-kappa2(T1.AP)
T1.TRkPMMtwo<-kappa2(T1.TR)
T5.APkPMMtwo<-kappa2(T5.AP)
T5.TRkPMMtwo<-kappa2(T5.TR)
T10.APkPMMtwo<-kappa2(T10.AP)
T10.TRkPMMtwo<-kappa2(T10.TR)
L1.APkPMMtwo<-kappa2(L1.AP)
L1.TRkPMMtwo<-kappa2(L1.TR)
L3.APkPMMtwo<-kappa2(L3.AP)
L3.TRkPMMtwo<-kappa2(L3.TR)

FL.LtauPMMtwo<-cor.test(dat$FL_L, five_two_imp$FL_L, method="kendall")
FL.RtauPMMtwo<-cor.test(dat$FL_R, five_two_imp$FL_R, method="kendall")
T1.APtauPMMtwo<-cor.test(dat$T1.AP, five_two_imp$T1.AP, method="kendall")
T1.TRtauPMMtwo<-cor.test(dat$T1.TR, five_two_imp$T1.TR, method="kendall")
T5.APtauPMMtwo<-cor.test(dat$T5.AP, five_two_imp$T5.AP, method="kendall")
T5.TRtauPMMtwo<-cor.test(dat$T5.TR, five_two_imp$T5.TR, method="kendall")
T10.APtauPMMtwo<-cor.test(dat$T10.AP, five_two_imp$T10.AP, method="kendall")
T10.TRtauPMMtwo<-cor.test(dat$T10.TR, five_two_imp$T10.TR, method="kendall")
L1.APtauPMMtwo<-cor.test(dat$L1.AP, five_two_imp$L1.AP, method="kendall")
L1.TRtauPMMtwo<-cor.test(dat$L1.TR, five_two_imp$L1.TR, method="kendall")
L3.APtauPMMtwo<-cor.test(dat$L3.AP, five_two_imp$L3.AP, method="kendall")
L3.TRtauPMMtwo<-cor.test(dat$L3.TR, five_two_imp$L3.TR, method="kendall")

#THREE
FL.L<-cbind(dat$FL_L, five_three_imp$FL_L)
FL.R<-cbind(dat$FL_R, five_three_imp$FL_R)
T1.AP<-cbind(dat$T1.AP, five_three_imp$T1.AP)
T1.TR<-cbind(dat$T1.TR, five_three_imp$T1.TR)
T5.AP<-cbind(dat$T5.AP, five_three_imp$T5.AP)
T5.TR<-cbind(dat$T5.TR, five_three_imp$T5.TR)
T10.AP<-cbind(dat$T10.AP, five_three_imp$T10.AP)
T10.TR<-cbind(dat$T10.TR, five_three_imp$T10.TR)
L1.AP<-cbind(dat$L1.AP, five_three_imp$L1.AP)
L1.TR<-cbind(dat$L1.TR, five_three_imp$L1.TR)
L3.AP<-cbind(dat$L3.AP, five_three_imp$L3.AP)
L3.TR<-cbind(dat$L3.TR, five_three_imp$L3.TR)

FL.LkPMMthree<-kappa2(FL.L)
FL.RkPMMthree<-kappa2(FL.R)
T1.APkPMMthree<-kappa2(T1.AP)
T1.TRkPMMthree<-kappa2(T1.TR)
T5.APkPMMthree<-kappa2(T5.AP)
T5.TRkPMMthree<-kappa2(T5.TR)
T10.APkPMMthree<-kappa2(T10.AP)
T10.TRkPMMthree<-kappa2(T10.TR)
L1.APkPMMthree<-kappa2(L1.AP)
L1.TRkPMMthree<-kappa2(L1.TR)
L3.APkPMMthree<-kappa2(L3.AP)
L3.TRkPMMthree<-kappa2(L3.TR)

FL.LtauPMMthree<-cor.test(dat$FL_L, five_three_imp$FL_L, method="kendall")
FL.RtauPMMthree<-cor.test(dat$FL_R, five_three_imp$FL_R, method="kendall")
T1.APtauPMMthree<-cor.test(dat$T1.AP, five_three_imp$T1.AP, method="kendall")
T1.TRtauPMMthree<-cor.test(dat$T1.TR, five_three_imp$T1.TR, method="kendall")
T5.APtauPMMthree<-cor.test(dat$T5.AP, five_three_imp$T5.AP, method="kendall")
T5.TRtauPMMthree<-cor.test(dat$T5.TR, five_three_imp$T5.TR, method="kendall")
T10.APtauPMMthree<-cor.test(dat$T10.AP, five_three_imp$T10.AP, method="kendall")
T10.TRtauPMMthree<-cor.test(dat$T10.TR, five_three_imp$T10.TR, method="kendall")
L1.APtauPMMthree<-cor.test(dat$L1.AP, five_three_imp$L1.AP, method="kendall")
L1.TRtauPMMthree<-cor.test(dat$L1.TR, five_three_imp$L1.TR, method="kendall")
L3.APtauPMMthree<-cor.test(dat$L3.AP, five_three_imp$L3.AP, method="kendall")
L3.TRtauPMMthree<-cor.test(dat$L3.TR, five_three_imp$L3.TR, method="kendall")

#FOUR
FL.L<-cbind(dat$FL_L, five_four_imp$FL_L)
FL.R<-cbind(dat$FL_R, five_four_imp$FL_R)
T1.AP<-cbind(dat$T1.AP, five_four_imp$T1.AP)
T1.TR<-cbind(dat$T1.TR, five_four_imp$T1.TR)
T5.AP<-cbind(dat$T5.AP, five_four_imp$T5.AP)
T5.TR<-cbind(dat$T5.TR, five_four_imp$T5.TR)
T10.AP<-cbind(dat$T10.AP, five_four_imp$T10.AP)
T10.TR<-cbind(dat$T10.TR, five_four_imp$T10.TR)
L1.AP<-cbind(dat$L1.AP, five_four_imp$L1.AP)
L1.TR<-cbind(dat$L1.TR, five_four_imp$L1.TR)
L3.AP<-cbind(dat$L3.AP, five_four_imp$L3.AP)
L3.TR<-cbind(dat$L3.TR, five_four_imp$L3.TR)

FL.LkPMMfour<-kappa2(FL.L)
FL.RkPMMfour<-kappa2(FL.R)
T1.APkPMMfour<-kappa2(T1.AP)
T1.TRkPMMfour<-kappa2(T1.TR)
T5.APkPMMfour<-kappa2(T5.AP)
T5.TRkPMMfour<-kappa2(T5.TR)
T10.APkPMMfour<-kappa2(T10.AP)
T10.TRkPMMfour<-kappa2(T10.TR)
L1.APkPMMfour<-kappa2(L1.AP)
L1.TRkPMMfour<-kappa2(L1.TR)
L3.APkPMMfour<-kappa2(L3.AP)
L3.TRkPMMfour<-kappa2(L3.TR)

FL.LtauPMMfour<-cor.test(dat$FL_L, five_four_imp$FL_L, method="kendall")
FL.RtauPMMfour<-cor.test(dat$FL_R, five_four_imp$FL_R, method="kendall")
T1.APtauPMMfour<-cor.test(dat$T1.AP, five_four_imp$T1.AP, method="kendall")
T1.TRtauPMMfour<-cor.test(dat$T1.TR, five_four_imp$T1.TR, method="kendall")
T5.APtauPMMfour<-cor.test(dat$T5.AP, five_four_imp$T5.AP, method="kendall")
T5.TRtauPMMfour<-cor.test(dat$T5.TR, five_four_imp$T5.TR, method="kendall")
T10.APtauPMMfour<-cor.test(dat$T10.AP, five_four_imp$T10.AP, method="kendall")
T10.TRtauPMMfour<-cor.test(dat$T10.TR, five_four_imp$T10.TR, method="kendall")
L1.APtauPMMfour<-cor.test(dat$L1.AP, five_four_imp$L1.AP, method="kendall")
L1.TRtauPMMfour<-cor.test(dat$L1.TR, five_four_imp$L1.TR, method="kendall")
L3.APtauPMMfour<-cor.test(dat$L3.AP, five_four_imp$L3.AP, method="kendall")
L3.TRtauPMMfour<-cor.test(dat$L3.TR, five_four_imp$L3.TR, method="kendall")

#FIVE
FL.L<-cbind(dat$FL_L, five_five_imp$FL_L)
FL.R<-cbind(dat$FL_R, five_five_imp$FL_R)
T1.AP<-cbind(dat$T1.AP, five_five_imp$T1.AP)
T1.TR<-cbind(dat$T1.TR, five_five_imp$T1.TR)
T5.AP<-cbind(dat$T5.AP, five_five_imp$T5.AP)
T5.TR<-cbind(dat$T5.TR, five_five_imp$T5.TR)
T10.AP<-cbind(dat$T10.AP, five_five_imp$T10.AP)
T10.TR<-cbind(dat$T10.TR, five_five_imp$T10.TR)
L1.AP<-cbind(dat$L1.AP, five_five_imp$L1.AP)
L1.TR<-cbind(dat$L1.TR, five_five_imp$L1.TR)
L3.AP<-cbind(dat$L3.AP, five_five_imp$L3.AP)
L3.TR<-cbind(dat$L3.TR, five_five_imp$L3.TR)

FL.LkPMMfive<-kappa2(FL.L)
FL.RkPMMfive<-kappa2(FL.R)
T1.APkPMMfive<-kappa2(T1.AP)
T1.TRkPMMfive<-kappa2(T1.TR)
T5.APkPMMfive<-kappa2(T5.AP)
T5.TRkPMMfive<-kappa2(T5.TR)
T10.APkPMMfive<-kappa2(T10.AP)
T10.TRkPMMfive<-kappa2(T10.TR)
L1.APkPMMfive<-kappa2(L1.AP)
L1.TRkPMMfive<-kappa2(L1.TR)
L3.APkPMMfive<-kappa2(L3.AP)
L3.TRkPMMfive<-kappa2(L3.TR)

FL.LtauPMMfive<-cor.test(dat$FL_L, five_five_imp$FL_L, method="kendall")
FL.RtauPMMfive<-cor.test(dat$FL_R, five_five_imp$FL_R, method="kendall")
T1.APtauPMMfive<-cor.test(dat$T1.AP, five_five_imp$T1.AP, method="kendall")
T1.TRtauPMMfive<-cor.test(dat$T1.TR, five_five_imp$T1.TR, method="kendall")
T5.APtauPMMfive<-cor.test(dat$T5.AP, five_five_imp$T5.AP, method="kendall")
T5.TRtauPMMfive<-cor.test(dat$T5.TR, five_five_imp$T5.TR, method="kendall")
T10.APtauPMMfive<-cor.test(dat$T10.AP, five_five_imp$T10.AP, method="kendall")
T10.TRtauPMMfive<-cor.test(dat$T10.TR, five_five_imp$T10.TR, method="kendall")
L1.APtauPMMfive<-cor.test(dat$L1.AP, five_five_imp$L1.AP, method="kendall")
L1.TRtauPMMfive<-cor.test(dat$L1.TR, five_five_imp$L1.TR, method="kendall")
L3.APtauPMMfive<-cor.test(dat$L3.AP, five_five_imp$L3.AP, method="kendall")
L3.TRtauPMMfive<-cor.test(dat$L3.TR, five_five_imp$L3.TR, method="kendall")

#Now we combine the results from each of the 5 versions
#This averages the means and variances across all 5 
FL.Lmean.PMM<-mean(FL.Lmean.PMM.1, FL.Lmean.PMM.2, FL.Lmean.PMM.3, FL.Lmean.PMM.4, FL.Lmean.PMM.5)
FL.Rmean.PMM<-mean(FL.Rmean.PMM.1, FL.Rmean.PMM.2, FL.Rmean.PMM.3, FL.Rmean.PMM.4, FL.Rmean.PMM.5)
T1.APmean.PMM<-mean(T1.APmean.PMM.1, T1.APmean.PMM.2, T1.APmean.PMM.3, T1.APmean.PMM.4, T1.APmean.PMM.5)
T1.TRmean.PMM<-mean(T1.TRmean.PMM.1, T1.TRmean.PMM.2, T1.TRmean.PMM.3, T1.TRmean.PMM.4, T1.TRmean.PMM.5)
T5.APmean.PMM<-mean(T5.APmean.PMM.1, T5.APmean.PMM.2, T5.APmean.PMM.3, T5.APmean.PMM.4, T5.APmean.PMM.5)
T5.TRmean.PMM<-mean(T5.TRmean.PMM.1, T5.TRmean.PMM.2, T5.TRmean.PMM.3, T5.TRmean.PMM.4, T5.TRmean.PMM.5)
T10.APmean.PMM<-mean(T10.APmean.PMM.1, T10.APmean.PMM.2, T10.APmean.PMM.3, T10.APmean.PMM.4, T10.APmean.PMM.5)
T10.TRmean.PMM<-mean(T10.TRmean.PMM.1, T10.TRmean.PMM.2, T10.TRmean.PMM.3, T10.TRmean.PMM.4, T10.TRmean.PMM.5)
L1.APmean.PMM<-mean(L1.APmean.PMM.1, L1.APmean.PMM.2, L1.APmean.PMM.3, L1.APmean.PMM.4, L1.APmean.PMM.5)
L1.TRmean.PMM<-mean(L1.TRmean.PMM.1, L1.TRmean.PMM.2, L1.TRmean.PMM.3, L1.TRmean.PMM.4, L1.TRmean.PMM.5)
L3.APmean.PMM<-mean(L3.APmean.PMM.1, L3.APmean.PMM.2, L3.APmean.PMM.3, L3.APmean.PMM.4, L3.APmean.PMM.5)
L3.TRmean.PMM<-mean(L3.TRmean.PMM.1, L3.TRmean.PMM.2, L3.TRmean.PMM.3, L3.TRmean.PMM.4, L3.TRmean.PMM.5)

FL.Lvar.PMM<-mean(FL.Lvar.PMM.1, FL.Lvar.PMM.2, FL.Lvar.PMM.3, FL.Lvar.PMM.4, FL.Lvar.PMM.5)
FL.Rvar.PMM<-mean(FL.Rvar.PMM.1, FL.Rvar.PMM.2, FL.Rvar.PMM.3, FL.Rvar.PMM.4, FL.Rvar.PMM.5)
T1.APvar.PMM<-mean(T1.APvar.PMM.1, T1.APvar.PMM.2, T1.APvar.PMM.3, T1.APvar.PMM.4, T1.APvar.PMM.5)
T1.TRvar.PMM<-mean(T1.TRvar.PMM.1, T1.TRvar.PMM.2, T1.TRvar.PMM.3, T1.TRvar.PMM.4, T1.TRvar.PMM.5)
T5.APvar.PMM<-mean(T5.APvar.PMM.1, T5.APvar.PMM.2, T5.APvar.PMM.3, T5.APvar.PMM.4, T5.APvar.PMM.5)
T5.TRvar.PMM<-mean(T5.TRvar.PMM.1, T5.TRvar.PMM.2, T5.TRvar.PMM.3, T5.TRvar.PMM.4, T5.TRvar.PMM.5)
T10.APvar.PMM<-mean(T10.APvar.PMM.1, T10.APvar.PMM.2, T10.APvar.PMM.3, T10.APvar.PMM.4, T10.APvar.PMM.5)
T10.TRvar.PMM<-mean(T10.TRvar.PMM.1, T10.TRvar.PMM.2, T10.TRvar.PMM.3, T10.TRvar.PMM.4, T10.TRvar.PMM.5)
L1.APvar.PMM<-mean(L1.APvar.PMM.1, L1.APvar.PMM.2, L1.APvar.PMM.3, L1.APvar.PMM.4, L1.APvar.PMM.5)
L1.TRvar.PMM<-mean(L1.TRvar.PMM.1, L1.TRvar.PMM.2, L1.TRvar.PMM.3, L1.TRvar.PMM.4, L1.TRvar.PMM.5)
L3.APvar.PMM<-mean(L3.APvar.PMM.1, L3.APvar.PMM.2, L3.APvar.PMM.3, L3.APvar.PMM.4, L3.APvar.PMM.5)
L3.TRvar.PMM<-mean(L3.TRvar.PMM.1, L3.TRvar.PMM.2, L3.TRvar.PMM.3, L3.TRvar.PMM.4, L3.TRvar.PMM.5)

#Now we combine the results from each of the 5 versions
#This averages the kappa and tau across all 5 
FL.Lkmean<-mean(FL.LkPMMone$value, FL.LkPMMtwo$value, FL.LkPMMthree$value, FL.LkPMMfour$value, FL.LkPMMfive$value)
FL.Rkmean<-mean(FL.RkPMMone$value, FL.RkPMMtwo$value, FL.RkPMMthree$value, FL.RkPMMfour$value, FL.RkPMMfive$value)
T1.APkmean<-mean(T1.APkPMMone$value, T1.APkPMMtwo$value,T1.APkPMMthree$value, T1.APkPMMfour$value, T1.APkPMMfive$value)
T1.TRkmean<-mean(T1.TRkPMMone$value, T1.TRkPMMtwo$value,T1.TRkPMMthree$value, T1.TRkPMMfour$value, T1.TRkPMMfive$value)
T5.APkmean<-mean(T5.APkPMMone$value, T5.APkPMMtwo$value,T5.APkPMMthree$value, T5.APkPMMfour$value, T5.APkPMMfive$value)
T5.TRkmean<-mean(T5.TRkPMMone$value, T5.TRkPMMtwo$value,T5.TRkPMMthree$value, T5.TRkPMMfour$value, T5.TRkPMMfive$value)
T10.APkmean<-mean(T10.APkPMMone$value, T10.APkPMMtwo$value,T10.APkPMMthree$value, T10.APkPMMfour$value, T10.APkPMMfive$value)
T10.TRkmean<-mean(T10.TRkPMMone$value, T10.TRkPMMtwo$value,T10.TRkPMMthree$value, T10.TRkPMMfour$value, T10.TRkPMMfive$value)
L1.APkmean<-mean(L1.APkPMMone$value, L1.APkPMMtwo$value,L1.APkPMMthree$value, L1.APkPMMfour$value, L1.APkPMMfive$value)
L1.TRkmean<-mean(L1.TRkPMMone$value, L1.TRkPMMtwo$value,L1.TRkPMMthree$value, L1.TRkPMMfour$value, L1.TRkPMMfive$value)
L3.APkmean<-mean(L3.APkPMMone$value, L3.APkPMMtwo$value,L3.APkPMMthree$value, L3.APkPMMfour$value, L3.APkPMMfive$value)
L3.TRkmean<-mean(L3.TRkPMMone$value, L3.TRkPMMtwo$value,L3.TRkPMMthree$value, L3.TRkPMMfour$value, L3.TRkPMMfive$value)

FL.Ltaumean<-mean(FL.LtauPMMone$estimate, FL.LtauPMMtwo$estimate, FL.LtauPMMthree$estimate, FL.LtauPMMfour$estimate, FL.LtauPMMfive$estimate)
FL.Rtaumean<-mean(FL.RtauPMMone$estimate, FL.RtauPMMtwo$estimate, FL.RtauPMMthree$estimate, FL.RtauPMMfour$estimate, FL.RtauPMMfive$estimate)
T1.APtaumean<-mean(T1.APtauPMMone$estimate, T1.APtauPMMtwo$estimate,T1.APtauPMMthree$estimate, T1.APtauPMMfour$estimate, T1.APtauPMMfive$estimate)
T1.TRtaumean<-mean(T1.TRtauPMMone$estimate, T1.TRtauPMMtwo$estimate,T1.TRtauPMMthree$estimate, T1.TRtauPMMfour$estimate, T1.TRtauPMMfive$estimate)
T5.APtaumean<-mean(T5.APtauPMMone$estimate, T5.APtauPMMtwo$estimate,T5.APtauPMMthree$estimate, T5.APtauPMMfour$estimate, T5.APtauPMMfive$estimate)
T5.TRtaumean<-mean(T5.TRtauPMMone$estimate, T5.TRtauPMMtwo$estimate,T5.TRtauPMMthree$estimate, T5.TRtauPMMfour$estimate, T5.TRtauPMMfive$estimate)
T10.APtaumean<-mean(T10.APtauPMMone$estimate, T10.APtauPMMtwo$estimate,T10.APtauPMMthree$estimate, T10.APtauPMMfour$estimate, T10.APtauPMMfive$estimate)
T10.TRtaumean<-mean(T10.TRtauPMMone$estimate, T10.TRtauPMMtwo$estimate,T10.TRtauPMMthree$estimate, T10.TRtauPMMfour$estimate, T10.TRtauPMMfive$estimate)
L1.APtaumean<-mean(L1.APtauPMMone$estimate, L1.APtauPMMtwo$estimate,L1.APtauPMMthree$estimate, L1.APtauPMMfour$estimate, L1.APtauPMMfive$estimate)
L1.TRtaumean<-mean(L1.TRtauPMMone$estimate, L1.TRtauPMMtwo$estimate,L1.TRtauPMMthree$estimate, L1.TRtauPMMfour$estimate, L1.TRtauPMMfive$estimate)
L3.APtaumean<-mean(L3.APtauPMMone$estimate, L3.APtauPMMtwo$estimate,L3.APtauPMMthree$estimate, L3.APtauPMMfour$estimate, L3.APtauPMMfive$estimate)
L3.TRtaumean<-mean(L3.TRtauPMMone$estimate, L3.TRtauPMMtwo$estimate,L3.TRtauPMMthree$estimate, L3.TRtauPMMfour$estimate, L3.TRtauPMMfive$estimate)

###################################
#Calculate Percent Error and Export
###################################

#This final chunk calculates the %error between actual and observed (imputed) values for the mean and variance
#Cohen's Kappa and Kendall's Tau produce the coefficient which shows the level of agreement
#The matrix puts the values in a row or column and exports as a .csv

ab<-c((abs((FL.Lmean.PMM-FL.Ldatmean)/FL.Ldatmean)*100),(abs((FL.Rmean.PMM-FL.Rdatmean)/FL.Rdatmean)*100),(abs((T1.APmean.PMM-T1.APdatmean)/T1.APdatmean)*100),(abs((T1.TRmean.PMM-T1.TRdatmean)/T1.TRdatmean)*100),(abs((T5.APmean.PMM-T5.APdatmean)/T5.APdatmean)*100), (abs((T5.TRmean.PMM-T5.TRdatmean)/T5.TRdatmean)*100), (abs((T10.APmean.PMM-T10.APdatmean)/T10.APdatmean)*100), (abs((T10.TRmean.PMM-T10.TRdatmean)/T10.TRdatmean)*100), (abs((L1.APmean.PMM-L1.APdatmean)/L1.APdatmean)*100), (abs((L1.TRmean.PMM-L1.TRdatmean)/L1.TRdatmean)*100), (abs((L3.APmean.PMM-L3.APdatmean)/L3.APdatmean)*100), (abs((L3.TRmean.PMM-L3.TRdatmean)/L3.TRdatmean)*100))

ac<-c((abs((FL.Lvar.PMM-FL.Ldatvar)/FL.Ldatvar)*100),(abs((FL.Rvar.PMM-FL.Rdatvar)/FL.Rdatvar)*100),(abs((T1.APvar.PMM-T1.APdatvar)/T1.APdatvar)*100),(abs((T1.TRvar.PMM-T1.TRdatvar)/T1.TRdatvar)*100),(abs((T5.APvar.PMM-T5.APdatvar)/T5.APdatvar)*100), (abs((T5.TRvar.PMM-T5.TRdatvar)/T5.TRdatvar)*100), (abs((T10.APvar.PMM-T10.APdatvar)/T10.APdatvar)*100), (abs((T10.TRvar.PMM-T10.TRdatvar)/T10.TRdatvar)*100), (abs((L1.APvar.PMM-L1.APdatvar)/L1.APdatvar)*100), (abs((L1.TRvar.PMM-L1.TRdatvar)/L1.TRdatvar)*100), (abs((L3.APvar.PMM-L3.APdatvar)/L3.APdatvar)*100), (abs((L3.TRvar.PMM-L3.TRdatvar)/L3.TRdatvar)*100))

ad<-matrix(c(FL.Lkmean, FL.Rkmean, T1.APkmean, T1.TRkmean, T5.APkmean, T5.TRkmean, T10.APkmean, T10.TRkmean, L1.APkmean, L1.TRkmean, L3.APkmean, L3.TRkmean), 12, 1)

ae<-matrix(c(FL.Ltaumean, FL.Rtaumean, T1.APtaumean, T1.TRtaumean, T5.APtaumean, T5.TRtaumean, T10.APtaumean, T10.TRtaumean, L1.APtaumean, L1.TRtaumean, L3.APtaumean, L3.TRtaumean), 12, 1)

dfmean<-data.frame(cbind(ab, ac, ad, ae))
colnames(dfmean)<-c("mean", "var", "kappa", "tau")
rownames(dfmean)<-c("FL.L", "FL.R", "T1.AP", "T1.TR", "T5.AP", "T5.TR", "T10.AP", "T10.TR", "L1.AP", "L1.TR", "L3.AP", "L3.TR")
write.csv(dfmean, file="imputed_data.csv")

#END