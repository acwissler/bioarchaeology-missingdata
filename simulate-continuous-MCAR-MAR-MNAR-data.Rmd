#####################
This file intoduces NA's to a complete dataset of continuous data and outputs as a .csv  
Creates 5 versions of variable percentages of data missing MCAR, MAR, MNAR
#####################


#This approach uses the R package 'missMethods'
#missMethods has the *delete_MCAR*, *delete_MAR*, and *delete_MNAR* functions which introduce missing values in a dataset so that the values are missing completely at random, missing at random, or missing not at random.
#continuousdata.csv is my dataset that has 12 variables (columns) and 369 rows (individuals) with no missing values

**Variable Names**
FL_L - femur length left
FL_R - femur length right
T1.AP - T1 antero-posterior length
T1.TR - T1 transverse length
L1.AP - L1 antero-posterior length
L1.TR - L1 transverse length

**Set up the workspace and load libraries**
rm(list=ls())
library(knitr)
library(missMethods)

setwd("C:/Users/Amanda Wissler/Documents/Spring/imputation")
datmiss<-read.csv("continuousdata.csv", header=T)

#Assigning the variable names
FL_L<-datmiss$FL_Left
FL_R<-datmiss$FL_Right
T1.AP<-datmiss$T1.AP
T1.TR<-datmiss$T1.TR
T5.AP<-datmiss$T5.AP
T5.TR<-datmiss$T5.TR
T10.AP<-datmiss$T10.AP
T10.TR<-datmiss$T10.TR
L1.AP<-datmiss$L1.AP
L1.TR<-datmiss$L1.TR
L3.AP<-datmiss$L3.AP
L3.TR<-datmiss$L3.TR

#Each variable will receive a different percentage of missingness
#10% for each femoral length
#15% for T1AP
#10% for T1TR
#12.5% for T5AP
#10% for T5TR
#T10AP 15%
#T10TR 15%
#L1AP 20%
#L1TR 15%
#L3AP 20%
#L3TR 15%

###############
#Simulate MCAR
###############

#p = sets a vector with the probability that each value will be missing
#col_miss = a vector of the column names in which missing data will be simulated. If you leave this blank missing data will be simulated in all columns 

p<-c(.1, .1, .15, .1, .125, .1, .15, .15, .2, .15, .2, .15)

col_mis<-c("FL_Left", "FL_Right", "T1.AP", "T1.TR", "T5.AP", "T5.TR", "T10.AP", "T10.TR", "L1.AP", "L1.TR", "L3.AP", "L3.TR")

cont.MCAR1<-delete_MCAR(datmiss, p, col_mis)
cont.MCAR2<-delete_MCAR(datmiss, p, col_mis)
cont.MCAR3<-delete_MCAR(datmiss, p, col_mis)
cont.MCAR4<-delete_MCAR(datmiss, p, col_mis)
cont.MCAR5<-delete_MCAR(datmiss, p, col_mis)

write.csv(cont.MCAR1, file="cont.MCAR1.csv")
write.csv(cont.MCAR2, file="cont.MCAR2.csv")
write.csv(cont.MCAR3, file="cont.MCAR3.csv")
write.csv(cont.MCAR4, file="cont.MCAR4.csv")
write.csv(cont.MCAR5, file="cont.MCAR5.csv")

##############
#Simulate MAR 
##############

#or MAR data, the pattern of missingness must depend on other variables in the dataset. This is controlled by cols_ctrl. 
#In this example, the patterns of missingness are dependent on the demographic variables age, sex, and ancestry

#p = sets a vector with the probability that each value will be missing
#col_mis = a vector of the column names in which missing data will be simulated. 
#If you leave col_mis blank missing data will be simulated in all columns 
#cols_ctrl = vector of column names which controls the creation of missing values in col_mis

p<-c(.1, .1, .15, .1, .125, .1, .15, .15, .2, .15, .2, .15)

col_mis<-c("FL_Left", "FL_Right", "T1.AP", "T1.TR", "T5.AP", "T5.TR", "T10.AP", "T10.TR", "L1.AP", "L1.TR", "L3.AP", "L3.TR")
cols_ctrl<-c("sex", "sex", "ancestry", "age", "age", "sex", "ancestry", "age", "sex", "age", "age", "ancestry")

cont.MAR1<-delete_MAR_rank(datmiss, p, col_mis, cols_ctrl)
cont.MAR2<-delete_MAR_rank(datmiss, p, col_mis, cols_ctrl)
cont.MAR3<-delete_MAR_rank(datmiss, p, col_mis, cols_ctrl)
cont.MAR4<-delete_MAR_rank(datmiss, p, col_mis, cols_ctrl)
cont.MAR5<-delete_MAR_rank(datmiss, p, col_mis, cols_ctrl)

write.csv(cont.MAR1, file="cont.MAR1.csv")
write.csv(cont.MAR2, file="cont.MAR2.csv")
write.csv(cont.MAR3, file="cont.MAR3.csv")
write.csv(cont.MAR4, file="cont.MAR4.csv")
write.csv(cont.MAR5, file="cont.MAR5.csv")

###############
#Simulate MNAR
###############

#p = sets a vector with the probability that each value will be missing
#col_mis = a vector of the column names in which missing data will be simulated. 
#If you leave col_mis blank missing data will be simulated in all columns 

p<-c(.1, .1, .15, .1, .125, .1, .15, .15, .2, .15, .2, .15)

col_mis<-c("FL_Left", "FL_Right", "T1.AP", "T1.TR", "T5.AP", "T5.TR", "T10.AP", "T10.TR", "L1.AP", "L1.TR", "L3.AP", "L3.TR")

cont.MNAR1<-delete_MNAR_rank(datmiss, p, col_mis)
cont.MNAR2<-delete_MNAR_rank(datmiss, p, col_mis)
cont.MNAR3<-delete_MNAR_rank(datmiss, p, col_mis)
cont.MNAR4<-delete_MNAR_rank(datmiss, p, col_mis)
cont.MNAR5<-delete_MNAR_rank(datmiss, p, col_mis)

write.csv(cont.MNAR1, file="cont.MNAR1.csv")
write.csv(cont.MNAR2, file="cont.MNAR2.csv")
write.csv(cont.MNAR3, file="cont.MNAR3.csv")
write.csv(cont.MNAR4, file="cont.MNAR4.csv")
write.csv(cont.MNAR5, file="cont.MNAR5.csv")

#END